(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{170:function(t,a,s){t.exports=s.p+"assets/img/project_demo.b293ebf8.png"},333:function(t,a,s){t.exports=s.p+"assets/img/full_demo.3828bf7b.png"},705:function(t,a,s){"use strict";s.r(a);var n=[function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"烟感报警演示工程（复杂）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#烟感报警演示工程（复杂）","aria-hidden":"true"}},[t._v("#")]),t._v(" 烟感报警演示工程（复杂）")]),t._v(" "),n("h2",{attrs:{id:"业务流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#业务流程","aria-hidden":"true"}},[t._v("#")]),t._v(" 业务流程")]),t._v(" "),n("p",[n("strong",[t._v("周期性采集或控制")]),t._v(" 在物联网领域是一个十分常见的功能。通常的做法是利用 MCU 中内置的硬件定时器，周期产生定时器中断，并在中断处理函数中使能采集或控制条件。然后在后台进程中触发调用对应的采集任务。但这一方案有以下两个明显缺陷：")]),t._v(" "),n("h3",{attrs:{id:"资源使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#资源使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 资源使用")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("任务")]),t._v(" "),n("th",[t._v("消息队列")]),t._v(" "),n("th",[t._v("软件定时器")]),t._v(" "),n("th",[t._v("事件")]),t._v(" "),n("th",[t._v("互斥锁")]),t._v(" "),n("th",[t._v("信号量")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("7")]),t._v(" "),n("td",[t._v("1")]),t._v(" "),n("td",[t._v("3")]),t._v(" "),n("td",[t._v("1")]),t._v(" "),n("td",[t._v("2")]),t._v(" "),n("td",[t._v("1")])])])]),t._v(" "),n("h3",{attrs:{id:"简要说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简要说明","aria-hidden":"true"}},[t._v("#")]),t._v(" 简要说明")]),t._v(" "),n("ol",[n("li",[t._v("根据资源使用情况确认系统配置文件是否满足")]),t._v(" "),n("li",[n("code",[t._v("Task_CloudCmd")]),t._v(" 任务模拟从云端主机接收命令，当接收到相应的命令后，发送响应的 "),n("code",[t._v("event")]),t._v(" 给 "),n("code",[t._v("Task_EventsHandle")]),t._v(";")]),t._v(" "),n("li",[n("code",[t._v("Task_SmokyAlarm")]),t._v(" 任务模拟监测报警传感器，将相应的 "),n("code",[t._v("event")]),t._v(" 发送给 "),n("code",[t._v("Task_EventsHandle")])]),t._v(" "),n("li",[n("code",[t._v("Task_EventsHandle")]),t._v(" 任务处理相关的 "),n("code",[t._v("event")]),t._v("，当 "),n("code",[t._v("event")]),t._v(" 是"),n("code",[t._v("IO")]),t._v("，则执行相关的 "),n("code",[t._v("IO")]),t._v(" 操作（print模拟）；当 "),n("code",[t._v("event")]),t._v(" 为"),n("code",[t._v("alarm")]),t._v("，则上报信息给云主机")]),t._v(" "),n("li",[n("code",[t._v("Task_Sample")]),t._v("（不止一个）根据自己的采样周期，定期将采样数据写入到采样消息队列")]),t._v(" "),n("li",[n("code",[t._v("Task_RecvQ")]),t._v(" 任务读取采样消息队列中的数据，并缓存到自己的链表中，当设定的时间超时或者接收消息数到达一定量时，则将接收的消息打包，上报给云主机")]),t._v(" "),n("li",[t._v("上报云主机目前使用打印模拟。")]),t._v(" "),n("li",[t._v("不论是打印还是上报，考虑到多任务，已经使用互斥锁处理。（上报的互斥锁，考虑业务因素予以保留）")])]),t._v(" "),n("h2",{attrs:{id:"代码解读"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码解读","aria-hidden":"true"}},[t._v("#")]),t._v(" 代码解读")]),t._v(" "),n("p",[n("a",{attrs:{href:"/full_demo.c"}},[t._v("源码浏览")])]),t._v(" "),n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),n("p",[t._v("代码较多，这里就不进行展示代码和解读")])]),t._v(" "),n("h3",{attrs:{id:"在-main-c-中添加-demo-入口函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在-main-c-中添加-demo-入口函数","aria-hidden":"true"}},[t._v("#")]),t._v(" 在 "),n("code",[t._v("main.c")]),t._v(" 中添加 demo 入口函数")]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/* USER CODE BEGIN PFP */")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("/* Private function prototypes -----------------------------------------------*/")]),t._v("\nUINT32 "),n("span",{attrs:{class:"token function"}},[t._v("Full_Demo")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("VOID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("/* USER CODE END PFP */")]),t._v("\n")])])]),n("div",{staticClass:"language-c extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[t._v("  "),n("span",{attrs:{class:"token comment"}},[t._v("/* USER CODE BEGIN 2 */")]),t._v("  \n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_KernelInit")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" LOS_NOK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n  "),n("span",{attrs:{class:"token function"}},[t._v("Full_Demo")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token function"}},[t._v("LOS_Start")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("/* USER CODE END 2 */")]),t._v("\n")])])]),n("h2",{attrs:{id:"代码验证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码验证","aria-hidden":"true"}},[t._v("#")]),t._v(" 代码验证")]),t._v(" "),n("p",[t._v("创建 "),n("code",[t._v("full_demo.c")]),t._v(" 源文件，合入到编译工程")]),t._v(" "),n("p",[n("img",{attrs:{src:s(170),alt:""}})]),t._v(" "),n("p",[t._v("编译通过后，在串口打印出如下信息。")]),t._v(" "),n("p",[n("img",{attrs:{src:s(333),alt:""}})])])}],_=s(0),v=Object(_.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);v.options.__file="a-comprehensive-smoky-demo.md";a.default=v.exports}}]);