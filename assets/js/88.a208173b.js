(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{162:function(a,t,s){a.exports=s.p+"assets/img/raw-project-copy-liteos.0fcbb562.png"},305:function(a,t,s){a.exports=s.p+"assets/img/raw-project-list-gcc.3194ccd3.png"},306:function(a,t,s){a.exports=s.p+"assets/img/raw-project-first-compile-gcc.faf7e097.png"},307:function(a,t,s){a.exports=s.p+"assets/img/raw-project-copy-osconfig.bc5fe825.png"},308:function(a,t,s){a.exports=s.p+"assets/img/raw-project-fix-makefile.0f84af10.png"},309:function(a,t,s){a.exports=s.p+"assets/img/raw-project-compile-ok-gcc.20961fcc.png"},310:function(a,t,s){a.exports=s.p+"assets/img/raw-project-build-result.b2cfe7f4.png"},698:function(a,t,s){"use strict";s.r(t);var n=[function(){var a=this,t=a.$createElement,n=a._self._c||t;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"stm32-系列（makefile-gcc）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#stm32-系列（makefile-gcc）","aria-hidden":"true"}},[a._v("#")]),a._v(" STM32 系列（Makefile/GCC）")]),a._v(" "),n("p",[n("a",{attrs:{href:"/porting/F103ZE_LiteOS_gcc.rar"}},[a._v("移植工程下载")])]),a._v(" "),n("h2",{attrs:{id:"编译-stm32cube-生成的裸机工程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编译-stm32cube-生成的裸机工程","aria-hidden":"true"}},[a._v("#")]),a._v(" 编译 STM32Cube 生成的裸机工程")]),a._v(" "),n("p",[a._v("默认的裸机工程如下图所示，会按照代码功能组织好。我们可以执行编译检查工程是否 OK。")]),a._v(" "),n("p",[n("img",{attrs:{src:s(305),alt:""}})]),a._v(" "),n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),n("p",[a._v("请务必提前安装好 "),n("strong",[a._v("GNU Tools ARM Embedded")]),a._v(" 工具链环境，在 STM32Cube 导出的裸机工程下执行 make 命令。如果能看到下图所示结果，证明您的环境已经部署好。")])]),a._v(" "),n("p",[n("img",{attrs:{src:s(306),alt:""}})]),a._v(" "),n("h2",{attrs:{id:"拷贝-liteos-kernel-相关目录到裸机工程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#拷贝-liteos-kernel-相关目录到裸机工程","aria-hidden":"true"}},[a._v("#")]),a._v(" 拷贝 LiteOS Kernel 相关目录到裸机工程")]),a._v(" "),n("p",[n("img",{attrs:{src:s(162),alt:""}})]),a._v(" "),n("p",[n("img",{attrs:{src:s(307),alt:""}})]),a._v(" "),n("p",[a._v("在 STM32Cube 生产的裸机工程中创建 "),n("strong",[a._v("Middlewares")]),a._v(" 目录，直接拷贝 LiteOS Kernel 相关目录。")]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("├─ Middlewares\n│  └─ LiteOS\n│     ├─ arch\n│     ├─ examples\n│     └─ kernel\n├─ OS_CONFIG\n")])])]),n("h2",{attrs:{id:"创建-liteos-kernel-相关-makefile-文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建-liteos-kernel-相关-makefile-文件","aria-hidden":"true"}},[a._v("#")]),a._v(" 创建 LiteOS Kernel 相关 makefile 文件")]),a._v(" "),n("p",[a._v("创建 "),n("code",[a._v("arch.mk")]),a._v(" 文件，添加 "),n("code",[a._v("arch")]),a._v(" 目录下相关的源文件和头文件路径")]),a._v(" "),n("div",{staticClass:"language-makefile extra-class"},[n("pre",{pre:!0,attrs:{class:"language-makefile"}},[n("code",[n("span",{attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\n"),n("span",{attrs:{class:"token comment"}},[a._v("# source")]),a._v("\n"),n("span",{attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\n"),n("span",{attrs:{class:"token comment"}},[a._v("# C sources")]),a._v("\nARCH_SRC "),n("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v("  \\\n        "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/arch/arm/arm-m/src/*.c"),n("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        C_SOURCES "),n("span",{attrs:{class:"token operator"}},[a._v("+=")]),a._v(" "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ARCH_SRC"),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),n("span",{attrs:{class:"token comment"}},[a._v("# ASM sources")]),a._v("\nASM_SOURCES_S "),n("span",{attrs:{class:"token operator"}},[a._v("+=")]),a._v("  \\\n../Middlewares/LiteOS/arch/arm/arm-m/cortex-m3/gcc/los_dispatch_gcc.S \n\n"),n("span",{attrs:{class:"token comment"}},[a._v("# C includes")]),a._v("\nARCH_INC "),n("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v(" \\\n        -I../Middlewares/LiteOS/arch/arm/arm-m/"),n("span",{attrs:{class:"token keyword"}},[a._v("include")]),a._v(" \\\n        -I../Middlewares/LiteOS/arch/arm/common/cmsis\n        C_INCLUDES "),n("span",{attrs:{class:"token operator"}},[a._v("+=")]),a._v(" "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ARCH_INC"),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("p",[a._v("创建 "),n("code",[a._v("kernel.mk")]),a._v(" 文件，添加 "),n("code",[a._v("kernel")]),a._v(" 目录下相关的源文件和头文件路径")]),a._v(" "),n("div",{staticClass:"language-makefile extra-class"},[n("pre",{pre:!0,attrs:{class:"language-makefile"}},[n("code",[n("span",{attrs:{class:"token comment"}},[a._v("######################################")]),a._v("\n"),n("span",{attrs:{class:"token comment"}},[a._v("# C sources")]),a._v("\nKERNEL_SRC "),n("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v("  \\\n        "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/*.c"),n("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/core/*.c"),n("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/ipc/*.c"),n("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/mem/bestfit_little/*.c"),n("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/mem/membox/*.c"),n("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/mem/common/*.c"),n("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/misc/*.c"),n("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/base/om/*.c"),n("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \\\n        "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("{")]),a._v("wildcard ../Middlewares/LiteOS/kernel/extended/tickless/*.c"),n("span",{attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        C_SOURCES "),n("span",{attrs:{class:"token operator"}},[a._v("+=")]),a._v(" "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("KERNEL_SRC"),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),n("span",{attrs:{class:"token comment"}},[a._v("# C includes")]),a._v("\nKERNEL_INC "),n("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v(" \\\n        -I ../Middlewares/LiteOS/kernel/base/"),n("span",{attrs:{class:"token keyword"}},[a._v("include")]),a._v("  \\\n        -I ../Middlewares/LiteOS/kernel/extended/"),n("span",{attrs:{class:"token keyword"}},[a._v("include")]),a._v("  \\\n        -I ../Middlewares/LiteOS/kernel/"),n("span",{attrs:{class:"token keyword"}},[a._v("include")]),a._v("\n        C_INCLUDES "),n("span",{attrs:{class:"token operator"}},[a._v("+=")]),a._v(" "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("KERNEL_INC"),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n")])])]),n("p",[a._v("最后修改 Makefile 文件，将刚刚创建好的 arch.mk 和 kernel.mk 包含进来。")]),a._v(" "),n("p",[n("img",{attrs:{src:s(308),alt:""}})]),a._v(" "),n("div",{staticClass:"language-makefile extra-class"},[n("pre",{pre:!0,attrs:{class:"language-makefile"}},[n("code",[a._v("OBJECTS "),n("span",{attrs:{class:"token operator"}},[a._v("+=")]),a._v(" "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("addprefix "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("BUILD_DIR"),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v("/,"),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{attrs:{class:"token keyword"}},[a._v("notdir")]),a._v(" "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ASM_SOURCES_S"),n("span",{attrs:{class:"token punctuation"}},[a._v(":")]),a._v(".S"),n("span",{attrs:{class:"token operator"}},[a._v("=")]),a._v(".o"),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),n("span",{attrs:{class:"token keyword"}},[a._v("vpath")]),a._v(" %.S "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{attrs:{class:"token keyword"}},[a._v("sort")]),a._v(" "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{attrs:{class:"token keyword"}},[a._v("dir")]),a._v(" "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ASM_SOURCES_S"),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),n("span",{attrs:{class:"token symbol"}},[n("span",{attrs:{class:"token variable"}},[a._v("$")]),a._v("(BUILD_DIR)/%.o")]),n("span",{attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" %.S Makefile "),n("span",{attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("BUILD_DIR"),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\t"),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("AS"),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" -c "),n("span",{attrs:{class:"token variable"}},[a._v("$")]),n("span",{attrs:{class:"token punctuation"}},[a._v("(")]),a._v("CFLAGS"),n("span",{attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{attrs:{class:"token variable"}},[a._v("$<")]),a._v(" -o "),n("span",{attrs:{class:"token variable"}},[a._v("$@")]),a._v("\n")])])]),n("h3",{attrs:{id:"编译无误，os-移植大功告成"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编译无误，os-移植大功告成","aria-hidden":"true"}},[a._v("#")]),a._v(" 编译无误，OS 移植大功告成")]),a._v(" "),n("p",[n("img",{attrs:{src:s(309),alt:""}})]),a._v(" "),n("p",[a._v("可以在 "),n("code",[a._v("build")]),a._v(" 目录下找到编译好的 bin 文件")]),a._v(" "),n("p",[n("img",{attrs:{src:s(310),alt:""}})])])}],e=s(0),r=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);r.options.__file="stm32-makefile.md";t.default=r.exports}}]);