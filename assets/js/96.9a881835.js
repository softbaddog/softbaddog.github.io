(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{170:function(t,s,a){t.exports=a.p+"assets/img/project_demo.b293ebf8.png"},334:function(t,s,a){t.exports=a.p+"assets/img/blinky_demo.e1f7e203.png"},706:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"周期点灯演示工程（简单）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#周期点灯演示工程（简单）","aria-hidden":"true"}},[t._v("#")]),t._v(" 周期点灯演示工程（简单）")]),t._v(" "),n("h2",{attrs:{id:"业务流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#业务流程","aria-hidden":"true"}},[t._v("#")]),t._v(" 业务流程")]),t._v(" "),n("p",[n("strong",[t._v("周期性采集或控制")]),t._v(" 在物联网领域是一个十分常见的功能。通常的做法是利用 MCU 中内置的硬件定时器，周期产生定时器中断，并在中断处理函数中使能采集或控制条件。然后在后台进程中触发调用对应的采集任务。但这一方案有以下两个明显缺陷：")]),t._v(" "),n("ol",[n("li",[t._v("如果周期采集任务种类较多，会浪费大量硬件定时器；")]),t._v(" "),n("li",[t._v("当多个采集任务先后触发，后台程序只能根据触发条件执行，无法保证任务按顺序处理。")])]),t._v(" "),n("p",[t._v("利用 LiteOS 软件定时器和消息队列读写机制，可以更为方便的解决上述问题。")]),t._v(" "),n("h3",{attrs:{id:"资源使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#资源使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 资源使用")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("任务")]),t._v(" "),n("th",[t._v("消息队列")]),t._v(" "),n("th",[t._v("软件定时器")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("1")]),t._v(" "),n("td",[t._v("1")]),t._v(" "),n("td",[t._v("2")])])])]),t._v(" "),n("h3",{attrs:{id:"简要说明"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简要说明","aria-hidden":"true"}},[t._v("#")]),t._v(" 简要说明")]),t._v(" "),n("ol",[n("li",[t._v("根据资源使用情况，确认系统的配置文件，相应资源是否配备")]),t._v(" "),n("li",[t._v("创建 2 个软件定时器，配置为周期模式，Timer1 每 1000ms 向队列中写入控灯1命令字 100，Timer2 每 500ms 向队列中写入控灯2命令字 200")]),t._v(" "),n("li",[t._v("消息队列接收任务，从队列中读取命令字，检查是否为期望的数据并输出相关信息（控制灯进行闪烁）；如果没有数据，该任务会阻塞。")])]),t._v(" "),n("h2",{attrs:{id:"代码解读"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码解读","aria-hidden":"true"}},[t._v("#")]),t._v(" 代码解读")]),t._v(" "),n("p",[n("a",{attrs:{href:"/blinky_demo.c"}},[t._v("源码浏览")])]),t._v(" "),n("h3",{attrs:{id:"_1-创建全局变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建全局变量","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 创建全局变量")]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" UINT32 g_QueueId"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           "),n("span",{attrs:{class:"token comment"}},[t._v("/* queue id */")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" UINT32 g_RecvTaskId"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("        "),n("span",{attrs:{class:"token comment"}},[t._v("/* task id */")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" UINT16 g_TimerLED1"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         "),n("span",{attrs:{class:"token comment"}},[t._v("/* timer1 id */")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" UINT16 g_TimerLED2"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         "),n("span",{attrs:{class:"token comment"}},[t._v("/* timer2 id */")]),t._v("\n")])])]),n("h3",{attrs:{id:"_2-函数入口-uint32-blinky-demo-void"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-函数入口-uint32-blinky-demo-void","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 函数入口 "),n("code",[t._v("UINT32 Blinky_Demo(void)")])]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[t._v("UINT32 "),n("span",{attrs:{class:"token function"}},[t._v("Blinky_Demo")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("VOID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT32 ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    TSK_INIT_PARAM_S stTask "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* Create the queue. */")]),t._v("\n    ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_QueueCreate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n              "),n("span",{attrs:{class:"token string"}},[t._v('"MsgQueue"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       "),n("span",{attrs:{class:"token comment"}},[t._v("/* queue name */")]),t._v("\n              QUEUE_LENGTH"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("     "),n("span",{attrs:{class:"token comment"}},[t._v("/* queue length */")]),t._v("\n              "),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("g_QueueId"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       "),n("span",{attrs:{class:"token comment"}},[t._v("/* queue id */")]),t._v("\n              "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                "),n("span",{attrs:{class:"token comment"}},[t._v("/* flags, not used */")]),t._v("\n              "),n("span",{attrs:{class:"token keyword"}},[t._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UINT32"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    "),n("span",{attrs:{class:"token comment"}},[t._v("/* message size */")]),t._v("\n              "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token function"}},[t._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"create the queue error:%x\\r\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    stTask"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pfnTaskEntry "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_ENTRY_FUNC"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("Task_RecvQ"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uwStackSize "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" RECV_TASK_STACK_SIZE"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pcName "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"RecvTask"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("usTaskPrio "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" RECV_TASK_PRIOR"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* Create the task. */")]),t._v("\n    ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_TaskCreate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n              "),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("g_RecvTaskId"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),n("span",{attrs:{class:"token comment"}},[t._v("/* receive task id */")]),t._v("\n              "),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask           "),n("span",{attrs:{class:"token comment"}},[t._v("/* task params */")]),t._v("\n              "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"create task_rcv error:%x\\r\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* Create the software timer1. */")]),t._v("\n    ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("Timers_Init")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token number"}},[t._v("1000")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" g_TimerLED1"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SND_CMD1_MSG"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"create timer error:%x\\r\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("Timers_Init")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token number"}},[t._v("500")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" g_TimerLED2"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" SND_CMD2_MSG"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"create timer error:%x\\r\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"_3-定时器回调函数-static-uint32-timer-init-uint32-ulinterval-uint16-ultimerid-uint32-ulsendmsg"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-定时器回调函数-static-uint32-timer-init-uint32-ulinterval-uint16-ultimerid-uint32-ulsendmsg","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. 定时器回调函数 "),n("code",[t._v("static UINT32 Timer_Init(UINT32 ulInterval, UINT16 ulTimerID, UINT32 ulSendMsg)")])]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" VOID "),n("span",{attrs:{class:"token function"}},[t._v("Timer_Callback")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UINT32 ulArg"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    UINT32 ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_QueueWriteCopy")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                g_QueueId"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("VOID "),n("span",{attrs:{class:"token operator"}},[t._v("*")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("ulArg"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("         "),n("span",{attrs:{class:"token comment"}},[t._v("/* send to msg */")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UINT32"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),n("span",{attrs:{class:"token number"}},[t._v("0")]),t._v("\n                "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"send message failure,error:%x\\r\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"_4-队列收消息任务处理函数-static-void-queue-recvtask-uint32-ularg"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-队列收消息任务处理函数-static-void-queue-recvtask-uint32-ularg","aria-hidden":"true"}},[t._v("#")]),t._v(" 4. 队列收消息任务处理函数 "),n("code",[t._v("static VOID Queue_RecvTask(UINT32 ulArg)")])]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" VOID "),n("span",{attrs:{class:"token function"}},[t._v("Task_RecvQ")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UINT32 ulArg"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT32 ulRecvMsg "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    UINT32 ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    UINT32 ulLength "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),n("span",{attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token number"}},[t._v("1")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ulLength "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("sizeof")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ulRecvMsg"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_QueueReadCopy")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_QueueId"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("ulRecvMsg"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("ulLength"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LOS_WAIT_FOREVER"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("switch")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ulRecvMsg"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("case")]),t._v(" SND_CMD1_MSG"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    "),n("span",{attrs:{class:"token function"}},[t._v("HAL_GPIO_TogglePin")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LED0_GPIO_Port"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LED0_Pin"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),n("span",{attrs:{class:"token keyword"}},[t._v("break")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("case")]),t._v(" SND_CMD2_MSG"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    "),n("span",{attrs:{class:"token function"}},[t._v("HAL_GPIO_TogglePin")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LED1_GPIO_Port"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LED1_Pin"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),n("span",{attrs:{class:"token keyword"}},[t._v("break")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{attrs:{class:"token keyword"}},[t._v("default")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    "),n("span",{attrs:{class:"token keyword"}},[t._v("break")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          \n            "),n("span",{attrs:{class:"token function"}},[t._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"RCVMSG:   OK:%d\\r\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ulRecvMsg"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("//valid message here")]),t._v("\n            ulRecvMsg "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("//clear the received message here.")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"_5-定期器初始化函数-static-uint32-timer-init-uint32-ulinterval-uint16-ultimerid-uint32-ulsendmsg"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-定期器初始化函数-static-uint32-timer-init-uint32-ulinterval-uint16-ultimerid-uint32-ulsendmsg","aria-hidden":"true"}},[t._v("#")]),t._v(" 5. 定期器初始化函数 "),n("code",[t._v("static UINT32 Timer_Init(UINT32 ulInterval, UINT16 ulTimerID, UINT32 ulSendMsg)")])]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" UINT32 "),n("span",{attrs:{class:"token function"}},[t._v("Timers_Init")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UINT32 ulInterval"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" UINT16 ulTimerID"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" UINT32 ulSendMsg"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT32 ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOS_OK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SwtmrCreate")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n              ulInterval"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("             "),n("span",{attrs:{class:"token comment"}},[t._v("/* interval for ulInterval tick */")]),t._v("\n              LOS_SWTMR_MODE_PERIOD"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{attrs:{class:"token comment"}},[t._v("/* peridic software timer */")]),t._v(" \n              Timer_Callback"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("         "),n("span",{attrs:{class:"token comment"}},[t._v("/* software timer callback function */")]),t._v("\n              "),n("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("ulTimerID"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("             "),n("span",{attrs:{class:"token comment"}},[t._v("/* software timer id */")]),t._v("\n              ulSendMsg               "),n("span",{attrs:{class:"token comment"}},[t._v("/* sendmsg */")]),t._v("\n"),n("span",{attrs:{class:"token macro property"}},[t._v("#"),n("span",{attrs:{class:"token directive keyword"}},[t._v("if")]),t._v(" (LOSCFG_BASE_CORE_SWTMR_ALIGN == YES)")]),t._v("\n              "),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" OS_SWTMR_ROUSES_ALLOW"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" OS_SWTMR_ALIGN_SENSITIVE\n"),n("span",{attrs:{class:"token macro property"}},[t._v("#"),n("span",{attrs:{class:"token directive keyword"}},[t._v("endif")])]),t._v("\n            "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ulRet "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_SwtmrStart")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ulTimerID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token function"}},[t._v("printf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v('"start software timer error:%x\\r\\n"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ulRet"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"_6-最后在-main-c-中添加-demo-入口函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-最后在-main-c-中添加-demo-入口函数","aria-hidden":"true"}},[t._v("#")]),t._v(" 6. 最后在 "),n("code",[t._v("main.c")]),t._v(" 中添加 demo 入口函数")]),t._v(" "),n("div",{staticClass:"language-c extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/* USER CODE BEGIN PFP */")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("/* Private function prototypes -----------------------------------------------*/")]),t._v("\nUINT32 "),n("span",{attrs:{class:"token function"}},[t._v("Blinky_Demo")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("VOID"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("/* USER CODE END PFP */")]),t._v("\n")])])]),n("div",{staticClass:"language-c extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[t._v("  "),n("span",{attrs:{class:"token comment"}},[t._v("/* USER CODE BEGIN 2 */")]),t._v("  \n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),n("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("LOS_KernelInit")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" LOS_NOK"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n  "),n("span",{attrs:{class:"token function"}},[t._v("Blinky_Demo")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token function"}},[t._v("LOS_Start")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("/* USER CODE END 2 */")]),t._v("\n")])])]),n("h2",{attrs:{id:"代码验证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码验证","aria-hidden":"true"}},[t._v("#")]),t._v(" 代码验证")]),t._v(" "),n("p",[t._v("创建 "),n("code",[t._v("blinky_demo.c")]),t._v(" 源文件，合入到编译工程")]),t._v(" "),n("p",[n("img",{attrs:{src:a(170),alt:""}})]),t._v(" "),n("p",[t._v("编译通过后，运行程序可以看到 LED1 和 LED2 间隔闪烁，同时在串口打印出如下信息。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(334),alt:""}})])])}],e=a(0),o=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);o.options.__file="a-simple-blinky-demo.md";s.default=o.exports}}]);